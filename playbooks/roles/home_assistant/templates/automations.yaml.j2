- alias: 'Marantz auto on'
  trigger:
    - platform: state
      entity_id: media_player.kodi
      from: 'off'
      to: 'idle'
    - platform: state
      entity_id: media_player.kallaren
      to: 'playing'
    - platform: state
      entity_id: binary_sensor.ps4
      from: 'off'
      to: 'on'
  action:
    - service: media_player.turn_on
      entity_id: media_player.marantz_sr5007
    - service: media_player.select_source
      data_template:
        entity_id: media_player.marantz_sr5007
        source: >
          {% raw %}
          {% if trigger.entity_id == 'media_player.kodi' %}
          MEDIA PLAYER
          {% elif trigger.entity_id == 'media_player.kallaren' %}
          CBL/SAT
          {% elif trigger.entity_id == 'binary_sensor.ps4' %}
          GAME
          {% endif %}
          {% endraw %}

- alias: 'Marantz auto off'
  trigger:
    - platform: state
      entity_id: media_player.kodi
      to: 'off'
      for:
        minutes: 1
    - platform: state
      entity_id: media_player.kallaren
      to: 'off'
      for:
        minutes: 1
    - platform: state
      entity_id: binary_sensor.ps4
      to: 'off'
      for:
        minutes: 1
  condition:
    condition: and
    conditions:
     - condition: state
       entity_id: media_player.kodi
       state: 'off'
     - condition: state
       entity_id: media_player.kallaren
       state: 'off'
     - condition: state
       entity_id: binary_sensor.ps4
       state: 'off'

  action:
    - service: homeassistant.turn_off
      entity_id: media_player.marantz_sr5007

- alias: 'Update Available Notifications'
  trigger:
    platform: state
    entity_id: updater.updater
  action:
    service: notify.pushover
    data:
      message: 'Update for Home Assistant is available.'
