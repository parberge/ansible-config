- alias: 'Marantz auto on + source'
  trigger:
    - platform: state
      entity_id: media_player.kodi
      from: 'off'
      to: 'idle'

    - platform: state
      entity_id: media_player.kallaren
      to: 'playing'
  action:
    - service: media_player.turn_on
      entity_id: media_player.marantz_sr5007
    - service: media_player.select_source
      data_template:
        entity_id: media_player.marantz_sr5007
        #source: 'MEDIA PLAYER'
        source: >
          {% raw %}
          {% if trigger.entity_id == 'media_player.kodi' %}
          MEDIA PLAYER
          {% elif trigger.entity_id == 'media_player.kallaren' %}
          CBL/SAT
          {% endif %}
          {% endraw %}

- alias: 'Marantz - auto off'
  trigger:
    - platform: state
      entity_id: media_player.kodi
      to: 'off'
      for:
        minutes: 1
    - platform: state
      entity_id: media_player.kallaren
      to: 'off'
      for:
        minutes: 1
  #condition:
  #  condition: and
  #  conditions:
  #   - condition: state
  #     entity_id: media_player.kodi
  #     state: 'off'

  action:
    - service: homeassistant.turn_off
      entity_id: media_player.marantz_sr5007

