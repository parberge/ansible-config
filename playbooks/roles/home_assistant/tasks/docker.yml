---

- name: "Downloading version {{ hass_download_image_version }} of home assistant docker image"
  become: yes
  docker_image:
    name: "homeassistant/{{ hass_image_variant }}:{{ hass_download_image_version }}"
    pull: True
  tags:
    - docker_container
    - hass_download_image
  register: hass_container_image

- name: "Starting home assistant docker container with version {{ hass_docker_image_version }}"
  become: yes
  docker_container:
    name: home_assistant
    image: "homeassistant/{{ hass_image_variant }}:{{ hass_docker_image_version }}"
    restart_policy: always
    state: started
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - "{{ home_assistant_cfg_dir }}:/config"
    devices: "{{ hass_docker_devices|default([]) }}"
    network_mode: host
    restart: "{{ hass_container_restart |default('no') }}"
  tags: docker_container
